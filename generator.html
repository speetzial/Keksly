<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keksly Generator - Build your embed code</title>
    <meta name="description" content="Create your Keksly cookie banner configuration and copy the ready-to-use embed snippet.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">


    <!-- Keksly Setup (Live Demo) -->
    <script>
        window.KekslyConfig = {
        "services": [
            {
            "id": "essential",
            "name": "Essential",
            "description": "Required for core website functionality.",
            "required": true,
            "enabled": true,
            "category": [
                "security_storage"
            ]
            },
            {
            "id": "umami",
            "name": "Umami",
            "description": "We use the privacy-friendly analytics tool Umami to analyze how our website is used without cookies and to improve our services.",
            "required": false,
            "enabled": false,
            "category": [
                "analytics_storage"
            ]
            }
        ],
        "texts": {
            "banner": {
            "title": "üç™ We respect your privacy",
            "description": "We use cookies to improve our site and show relevant content. You decide what runs."
            },
            "settings": {
            "title": "Cookie settings",
            "save": "Save",
            "back": "Back"
            },
            "links": {
            "privacyPolicy": {
                "text": "Privacy Policy",
                "url": "#"
            },
            "imprint": {
                "text": "Imprint",
                "url": "https://mein.online-impressum.de/speetzen/"
            }
            }
        },
        "design": {
            "primaryColor": "#2563eb",
            "backgroundColor": "#ffffff",
            "textColor": "#1f2937",
            "fontFamily": "Inter, system-ui, -apple-system, sans-serif",
            "position": "center",
            "buttons": [
            {
                "type": "accept",
                "label": "Accept all",
                "variant": "secondary"
            },
            {
                "type": "reject",
                "label": "Reject all",
                "variant": "secondary"
            },
            {
                "type": "settings",
                "label": "Customize",
                "variant": "secondary"
            }
            ]
        },
        "gcm": {
            "enabled": true
        }
        };
    </script>
    <script src="keksly.js"></script>




    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --text: #1f2937;
            --text-light: #6b7280;
            --bg: #ffffff;
            --bg-alt: #f9fafb;
            --border: #e5e7eb;
            --code-bg: #1e293b;
            --code-text: #e2e8f0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--text);
            line-height: 1.6;
            background-color: var(--bg);
            -webkit-font-smoothing: antialiased;
        }

        a {
            color: var(--primary);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--primary-dark);
        }

        /* Layout */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        section {
            padding: 80px 0;
        }

        /* Header */
        header {
            padding: 20px 0;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-weight: 800;
            font-size: 1.5rem;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-links {
            display: flex;
            gap: 24px;
        }

        .nav-links a {
            color: var(--text-light);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        /* Hero */
        .hero {
            text-align: center;
            padding: 120px 0 80px;
            background: radial-gradient(circle at 50% 0%, #eff6ff 0%, transparent 70%);
        }

        .hero h1 {
            font-size: 3rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            margin-bottom: 20px;
            background: linear-gradient(to right, #111827, #4b5563);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1.15rem;
            color: var(--text-light);
            max-width: 620px;
            margin: 0 auto 32px;
        }

        .hero-btns {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            font-size: 0.95rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
        }

        .btn-secondary {
            background-color: white;
            border: 1px solid var(--border);
            color: var(--text);
        }

        .btn-secondary:hover {
            border-color: var(--text-light);
            background-color: var(--bg-alt);
        }

        .btn-ghost {
            background: none;
            border: 1px dashed var(--border);
            color: var(--text-light);
        }

        .btn-ghost:hover {
            color: var(--text);
            border-color: var(--text);
            background: var(--bg-alt);
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 0.85rem;
        }

        /* Badges */
        .badges {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 32px;
            flex-wrap: wrap;
        }

        .pill {
            padding: 8px 14px;
            border-radius: 999px;
            background: #eef2ff;
            color: #312e81;
            font-weight: 600;
            border: 1px solid #e0e7ff;
            font-size: 0.9rem;
        }

        /* Sections */
        .section-title {
            text-align: center;
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .section-desc {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 40px;
            font-size: 1.05rem;
        }

        .features {
            background-color: var(--bg-alt);
        }

        /* Panels / Cards */
        .panel {
            background: white;
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 24px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.04);
        }

        .panel h3 {
            margin-bottom: 14px;
            font-size: 1.2rem;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 14px;
        }

        .panel-subtext {
            color: var(--text-light);
            font-size: 0.95rem;
            margin-bottom: 16px;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 14px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text);
        }

        .form-group small {
            color: var(--text-light);
            font-size: 0.85rem;
        }

        input[type="text"],
        input[type="url"],
        input[type="number"],
        select,
        textarea,
        input[type="color"] {
            width: 100%;
            padding: 11px 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: #f9fafb;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input[type="color"] {
            height: 44px;
            padding: 6px 10px;
        }

        textarea {
            min-height: 96px;
            resize: vertical;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
        }

        /* Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 46px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #d1d5db;
            transition: .3s;
            border-radius: 26px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
        }

        input:checked+.slider {
            background-color: var(--primary);
        }

        input:checked+.slider:before {
            transform: translateX(20px);
        }

        /* Services */
        .service-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 14px;
        }

        .service-card {
            background: #f8fafc;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .service-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .service-title {
            font-weight: 700;
            color: var(--text);
        }

        .tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 999px;
            background: #eef2ff;
            color: #312e81;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .service-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .toggle-group {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: #fff;
        }

        .toggle-label {
            font-size: 0.9rem;
            color: var(--text);
            font-weight: 600;
        }

        .inline-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 10px;
        }

        /* Buttons list */
        .button-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 10px;
            padding: 12px 14px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: #f9fafb;
            align-items: center;
        }

        .button-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .stack {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Code */
        pre {
            background-color: var(--code-bg);
            color: var(--code-text);
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            margin: 16px 0;
            border: 1px solid #334155;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .code-output {
            width: 100%;
            min-height: 200px;
            background: var(--code-bg);
            color: var(--code-text);
            padding: 18px;
            border-radius: 10px;
            border: 1px solid #334155;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
        }

        .inline-code {
            background-color: #f1f5f9;
            color: #0f172a;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            font-family: 'Menlo', monospace;
        }

        .hint {
            color: var(--text-light);
            font-size: 0.93rem;
        }

        .chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .chip-btn {
            padding: 8px 12px;
            border-radius: 999px;
            border: 1px dashed var(--border);
            background: #f8fafc;
            color: var(--text);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .chip-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .notice {
            background: #ecfeff;
            color: #0ea5e9;
            border: 1px solid #cffafe;
            border-radius: 10px;
            padding: 12px 14px;
            font-weight: 600;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .hero h1 {
                font-size: 2.4rem;
            }
        }

        footer {
            background-color: #111827;
            color: #9ca3af;
            padding: 60px 0;
            text-align: center;
        }

        footer p {
            margin-bottom: 20px;
        }

        .footer-links a {
            color: white;
            margin: 0 12px;
            font-size: 0.9rem;
        }
    </style>
</head>

<body>
    <header>
        <div class="container nav">
            <div class="logo">üç™ Keksly</div>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="#config">Configurator</a>
                <a href="#output">Script</a>
                <a href="https://codeberg.org/speetzial/Keksly" target="_blank">Codeberg</a>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero -->
        <section class="hero">
            <div class="container">
                <h1>Keksly Generator</h1>
                <p>Build your cookie banner config with the form and grab a ready-to-use <span class="inline-code">&lt;script&gt;</span>.
                    Service-based, Google Consent Mode v2 ready, zero dependencies.</p>

                <div class="hero-btns">
                    <a href="#config" class="btn btn-primary">Start configuring</a>
                    <a href="#output" class="btn btn-secondary" id="scrollToOutput">Jump to script</a>
                    <a href="index.html" class="btn btn-secondary">Back to landing</a>
                </div>

                <div class="badges">
                    <div class="pill">Google Consent Mode v2</div>
                    <div class="pill">Service-based</div>
                    <div class="pill">Zero Dependencies</div>
                </div>
            </div>
        </section>

        <!-- Configurator -->
        <section id="config">
            <div class="container">
                <h2 class="section-title">Your banner settings</h2>
                <p class="section-desc">Adjust copy, colors, buttons, and services. All changes update the script live.</p>

                <div class="card-grid">
                    <div class="panel">
                        <div class="panel-header">
                            <h3>Texts</h3>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="banner-title">Banner title</label>
                                <input id="banner-title" type="text" data-field="texts.bannerTitle"
                                    placeholder="We respect your privacy">
                            </div>
                            <div class="form-group">
                                <label for="settings-title">Settings modal title</label>
                                <input id="settings-title" type="text" data-field="texts.settingsTitle"
                                    placeholder="Cookie settings">
                            </div>
                            <div class="form-group">
                                <label for="banner-desc">Banner description</label>
                                <textarea id="banner-desc" data-field="texts.bannerDescription"
                                    placeholder="We use cookies to..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="settings-save">Settings button: Save</label>
                                <input id="settings-save" type="text" data-field="texts.settingsSave" placeholder="Save">
                            </div>
                            <div class="form-group">
                                <label for="settings-back">Settings button: Back</label>
                                <input id="settings-back" type="text" data-field="texts.settingsBack" placeholder="Back">
                            </div>
                            <div class="form-group">
                                <label for="history-link">History link label</label>
                                <input id="history-link" type="text" data-field="texts.historyLink" placeholder="View your consent history">
                            </div>
                            <div class="form-group">
                                <label for="history-title">History panel title</label>
                                <input id="history-title" type="text" data-field="texts.historyTitle" placeholder="Consent History">
                            </div>
                            <div class="form-group">
                                <label for="history-empty">History empty state</label>
                                <input id="history-empty" type="text" data-field="texts.historyEmpty" placeholder="No history entries yet.">
                            </div>
                            <div class="form-group">
                                <label for="privacy-text">Link: Privacy Policy</label>
                                <input id="privacy-text" type="text" data-field="texts.privacyText" placeholder="Privacy Policy">
                                <input type="url" data-field="texts.privacyUrl" placeholder="https://example.com/privacy">
                            </div>
                            <div class="form-group">
                                <label for="imprint-text">Link: Imprint / Legal</label>
                                <input id="imprint-text" type="text" data-field="texts.imprintText" placeholder="Imprint">
                                <input type="url" data-field="texts.imprintUrl" placeholder="https://example.com/imprint">
                            </div>
                            <div class="form-group">
                                <label for="banner-version">Banner version</label>
                                <input id="banner-version" type="number" min="1" step="1" data-field="version" placeholder="1">
                                <small>Increase this number to force the banner to reappear for all users.</small>
                            </div>
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panel-header">
                            <h3>Design &amp; position</h3>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="primary-color">Primary color</label>
                                <input id="primary-color" type="color" data-field="design.primaryColor">
                            </div>
                            <div class="form-group">
                                <label for="bg-color">Banner background</label>
                                <input id="bg-color" type="color" data-field="design.backgroundColor">
                            </div>
                            <div class="form-group">
                                <label for="text-color">Text color</label>
                                <input id="text-color" type="color" data-field="design.textColor">
                            </div>
                            <div class="form-group">
                                <label for="font-family">Font</label>
                                <input id="font-family" type="text" data-field="design.fontFamily"
                                    placeholder="Inter, system-ui, -apple-system, sans-serif">
                            </div>
                            <div class="form-group">
                                <label for="position">Position</label>
                                <select id="position" data-field="design.position">
                                    <option value="bottom">Bottom right</option>
                                    <option value="center">Center (with backdrop)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Google Consent Mode v2</label>
                                <label class="switch">
                                    <input type="checkbox" data-field="gcmEnabled" id="gcm-enabled">
                                    <span class="slider"></span>
                                </label>
                                <small>Updates GCM signals automatically based on services.</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel" style="margin-bottom: 24px;">
                    <div class="panel-header">
                        <h3>Buttons &amp; order</h3>
                        <span class="panel-subtext">Adjust labels, variants, and ordering of your banner buttons.</span>
                    </div>
                    <div id="button-list" class="stack"></div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <h3>Services</h3>
                        <div class="chips">
                            <button class="chip-btn" data-template="analytics">+ Google Analytics</button>
                            <button class="chip-btn" data-template="ads">+ Google Ads</button>
                            <button class="chip-btn" data-template="tagmanager">+ Google Tag Manager</button>
                        </div>
                    </div>
                    <p class="panel-subtext">Service-based consent: users allow individual tools, optionally mapped to Google Consent Mode signals.</p>
                    <div id="service-list" class="service-list"></div>
                    <div style="margin-top: 14px;">
                        <button class="btn btn-ghost" id="add-service">+ Add another service</button>
                    </div>
                    <div class="notice">Pro tip: <span class="inline-code">required: true</span> makes a service non-disableable (e.g., essential).</div>
                </div>
            </div>
        </section>

        <!-- Output -->
        <section id="output" class="features">
            <div class="container">
                <h2 class="section-title">Ready-to-use script</h2>
                <p class="section-desc">Drop this into your <span class="inline-code">&lt;head&gt;</span> before loading
                    <span class="inline-code">keksly.js</span>.</p>

                <div class="panel">
                    <div class="panel-header">
                        <h3>Embed Snippet</h3>
                        <div class="button-actions">
                            <button class="btn btn-secondary btn-small" data-copy-target="code-output">Copy to clipboard</button>
                        </div>
                    </div>
                    <textarea id="code-output" class="code-output" readonly></textarea>
                    <p class="hint" id="copy-status">Live updates as you edit.</p>
                </div>

                <div class="panel" style="margin-top: 20px;">
                    <div class="panel-header">
                        <h3>Script-blocking example</h3>
                        <div class="button-actions">
                            <button class="btn btn-secondary btn-small" data-copy-target="blocking-example">Copy snippet</button>
                        </div>
                    </div>
                    <p class="panel-subtext">Load third-party scripts only after consent for the matching service.</p>
                    <pre id="blocking-example"></pre>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>Released under the MIT License.</p>
            <p>Made in EU üá™üá∫</p>
            <p style="max-width: 780px; margin: 0 auto 12px; color: #d1d5db;">Keksly and the provided example texts/snippets are offered ‚Äúas is‚Äù without warranty. They do not constitute legal advice. You are solely responsible for your implementation, wording, and compliance; the author assumes no liability.</p>
            <div class="footer-links">
                <a href="https://codeberg.org/speetzial/Keksly">Codeberg</a>
                <a href="https://codeberg.org/speetzial/Keksly/issues">Issues</a>
                <a href="https://mein.online-impressum.de/speetzen/">Imprint</a>
            </div>
        </div>
    </footer>

    <script>
        (() => {
            const state = {
                version: 1,
                texts: {
                    bannerTitle: 'üç™ We respect your privacy',
                    bannerDescription: 'We use cookies to improve our site and show relevant content. You decide what runs.',
                    settingsTitle: 'Cookie settings',
                    settingsSave: 'Save',
                    settingsBack: 'Back',
                    historyLink: 'View your consent history',
                    historyTitle: 'Consent History',
                    historyEmpty: 'No history entries yet.',
                    privacyText: 'Privacy Policy',
                    privacyUrl: 'https://example.com/privacy',
                    imprintText: 'Imprint',
                    imprintUrl: 'https://example.com/imprint'
                },
                design: {
                    primaryColor: '#2563eb',
                    backgroundColor: '#ffffff',
                    textColor: '#1f2937',
                    fontFamily: 'Inter, system-ui, -apple-system, sans-serif',
                    position: 'bottom'
                },
                gcmEnabled: true,
                buttons: [
                    { type: 'accept', label: 'Accept all', variant: 'primary', enabled: true },
                    { type: 'settings', label: 'Customize', variant: 'secondary', enabled: true },
                    { type: 'reject', label: 'Reject all', variant: 'text', enabled: true }
                ],
                services: [
                    {
                        id: 'essential',
                        name: 'Essential',
                        description: 'Required for core website functionality.',
                        required: true,
                        enabled: true,
                        category: ['security_storage']
                    },
                    {
                        id: 'analytics',
                        name: 'Analytics',
                        description: 'Helps us improve the website.',
                        required: false,
                        enabled: false,
                        category: ['analytics_storage']
                    }
                ]
            };

            const templates = {
                analytics: {
                    id: 'google_analytics',
                    name: 'Google Analytics',
                    description: 'Anonymized usage statistics.',
                    required: false,
                    enabled: false,
                    category: ['analytics_storage']
                },
                ads: {
                    id: 'google_ads',
                    name: 'Google Ads',
                    description: 'Personalized advertising.',
                    required: false,
                    enabled: false,
                    category: ['ad_storage', 'ad_user_data', 'ad_personalization']
                },
                tagmanager: {
                    id: 'google_tag_manager',
                    name: 'Google Tag Manager',
                    description: 'Loads tags based on consent.',
                    required: false,
                    enabled: false,
                    category: ['functionality_storage']
                }
            };

            const outputEl = document.getElementById('code-output');
            const blockingEl = document.getElementById('blocking-example');
            const statusEl = document.getElementById('copy-status');

            function getByPath(obj, path) {
                return path.split('.').reduce((acc, key) => acc && acc[key], obj);
            }

            function setByPath(obj, path, value) {
                const keys = path.split('.');
                const last = keys.pop();
                let current = obj;
                keys.forEach(k => {
                    if (!current[k]) current[k] = {};
                    current = current[k];
                });
                current[last] = value;
            }

            function createServiceTemplate() {
                const count = state.services.length + 1;
                return {
                    id: `service_${count}`,
                    name: 'New Service',
                    description: 'Describe what the service does.',
                    required: false,
                    enabled: false,
                    category: []
                };
            }

            function handleFieldChange(event) {
                const path = event.target.dataset.field;
                if (!path) return;
                const value = event.target.type === 'checkbox' ? event.target.checked : event.target.value;
                setByPath(state, path, value);
                renderScript();
            }

            function renderButtonRow(btn, index) {
                const row = document.createElement('div');
                row.className = 'button-row';
                row.innerHTML = `
                    <div class="form-group">
                        <label>Action</label>
                        <div class="inline-code">${btn.type}</div>
                    </div>
                    <div class="form-group">
                        <label>Label</label>
                        <input type="text" value="${btn.label}">
                    </div>
                    <div class="form-group">
                        <label>Variant</label>
                        <select>
                            <option value="primary" ${btn.variant === 'primary' ? 'selected' : ''}>Primary</option>
                            <option value="secondary" ${btn.variant === 'secondary' ? 'selected' : ''}>Secondary</option>
                            <option value="text" ${btn.variant === 'text' ? 'selected' : ''}>Text</option>
                        </select>
                    </div>
                    <div class="button-actions">
                        <label class="switch">
                            <input type="checkbox" ${btn.enabled ? 'checked' : ''}>
                            <span class="slider"></span>
                        </label>
                        <button class="btn btn-secondary btn-small" data-move="up" ${index === 0 ? 'disabled' : ''}>‚Üë</button>
                        <button class="btn btn-secondary btn-small" data-move="down" ${index === state.buttons.length - 1 ? 'disabled' : ''}>‚Üì</button>
                    </div>
                `;

                const labelInput = row.querySelector('input[type="text"]');
                const variantSelect = row.querySelector('select');
                const toggle = row.querySelector('input[type="checkbox"]');

                labelInput.addEventListener('input', () => {
                    state.buttons[index].label = labelInput.value;
                    renderScript();
                });

                variantSelect.addEventListener('change', () => {
                    state.buttons[index].variant = variantSelect.value;
                    renderScript();
                });

                toggle.addEventListener('change', () => {
                    state.buttons[index].enabled = toggle.checked;
                    renderScript();
                });

                row.querySelectorAll('button[data-move]').forEach(btnEl => {
                    btnEl.addEventListener('click', () => {
                        const dir = btnEl.dataset.move === 'up' ? -1 : 1;
                        const swapIndex = index + dir;
                        const temp = state.buttons[swapIndex];
                        state.buttons[swapIndex] = state.buttons[index];
                        state.buttons[index] = temp;
                        renderButtons();
                        renderScript();
                    });
                });

                return row;
            }

            function renderButtons() {
                const container = document.getElementById('button-list');
                container.innerHTML = '';
                state.buttons.forEach((btn, index) => {
                    container.appendChild(renderButtonRow(btn, index));
                });
            }

            function renderServices() {
                const container = document.getElementById('service-list');
                container.innerHTML = '';

                state.services.forEach((service, index) => {
                    const card = document.createElement('div');
                    card.className = 'service-card';
                    card.innerHTML = `
                        <div class="service-top">
                            <div class="service-title">${service.name || 'Service'}</div>
                            <div class="service-actions">
                                <div class="toggle-group" title="Enabled by default">
                                    <span class="toggle-label">Active</span>
                                    <label class="switch">
                                        <input type="checkbox" ${service.enabled ? 'checked' : ''}>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="toggle-group" title="Cannot be turned off by the user">
                                    <span class="toggle-label">Required</span>
                                    <label class="switch">
                                        <input type="checkbox" ${service.required ? 'checked' : ''}>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <button class="btn btn-secondary btn-small" data-remove ${service.required && index === 0 ? 'disabled' : ''}>Remove</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Service ID</label>
                            <input type="text" value="${service.id}">
                        </div>
                        <div class="form-group">
                            <label>Display name</label>
                            <input type="text" value="${service.name}">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea>${service.description || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label>Categories (GCM)</label>
                            <input type="text" value="${(service.category || []).join(', ')}" placeholder="e.g. analytics_storage, ad_storage">
                            <small>Comma separated: ad_storage, ad_user_data, ad_personalization, analytics_storage, functionality_storage, personalization_storage, security_storage</small>
                        </div>
                    `;

                    const titleEl = card.querySelector('.service-title');
                    const [enabledToggle, requiredToggle] = card.querySelectorAll('.switch input');
                    const [idInput, nameInput, descInput, catInput] = card.querySelectorAll('input[type="text"], textarea');
                    const removeBtn = card.querySelector('[data-remove]');

                    enabledToggle.addEventListener('change', () => {
                        state.services[index].enabled = enabledToggle.checked;
                        renderScript();
                    });

                    requiredToggle.addEventListener('change', () => {
                        state.services[index].required = requiredToggle.checked;
                        if (requiredToggle.checked) state.services[index].enabled = true;
                        renderServices();
                        renderScript();
                    });

                    idInput.addEventListener('input', () => {
                        state.services[index].id = idInput.value.trim();
                        renderScript();
                    });

                    nameInput.addEventListener('input', () => {
                        state.services[index].name = nameInput.value;
                        if (titleEl) titleEl.textContent = nameInput.value || 'Service';
                        renderScript();
                    });

                    descInput.addEventListener('input', () => {
                        state.services[index].description = descInput.value;
                        renderScript();
                    });

                    catInput.addEventListener('input', () => {
                        state.services[index].category = catInput.value.split(',').map(c => c.trim()).filter(Boolean);
                        renderScript();
                    });

                    if (removeBtn) {
                        removeBtn.addEventListener('click', () => {
                            state.services.splice(index, 1);
                            renderServices();
                            renderScript();
                        });
                    }

                    container.appendChild(card);
                });
            }

            function buildConfig() {
                return {
                    version: Number(state.version) || 1,
                    services: state.services.map(service => ({
                        id: service.id || 'service_id',
                        name: service.name || 'Service',
                        description: service.description || '',
                        required: !!service.required,
                        enabled: !!service.enabled,
                        category: Array.isArray(service.category) ? service.category : []
                    })),
                    texts: {
                        banner: {
                            title: state.texts.bannerTitle,
                            description: state.texts.bannerDescription
                        },
                        settings: {
                            title: state.texts.settingsTitle,
                            save: state.texts.settingsSave,
                            back: state.texts.settingsBack,
                            historyLink: state.texts.historyLink,
                            historyTitle: state.texts.historyTitle,
                            historyEmpty: state.texts.historyEmpty
                        },
                        links: {
                            privacyPolicy: { text: state.texts.privacyText, url: state.texts.privacyUrl },
                            imprint: { text: state.texts.imprintText, url: state.texts.imprintUrl }
                        }
                    },
                    design: {
                        primaryColor: state.design.primaryColor,
                        backgroundColor: state.design.backgroundColor,
                        textColor: state.design.textColor,
                        fontFamily: state.design.fontFamily,
                        position: state.design.position,
                        buttons: state.buttons
                            .filter(btn => btn.enabled)
                            .map(btn => ({ type: btn.type, label: btn.label, variant: btn.variant }))
                    },
                    gcm: {
                        enabled: !!state.gcmEnabled
                    }
                };
            }

            function renderScript() {
                const config = buildConfig();
                const scriptClose = '</scr' + 'ipt>';
                const code = `<script>
window.KekslyConfig = ${JSON.stringify(config, null, 2)};
${scriptClose}
<script src="https://cdn.keksly.eu/1.1.0/keksly.min.js">${scriptClose}`;
                outputEl.value = code;
                if (statusEl) statusEl.textContent = 'Live updates as you edit.';

                const firstService = state.services.find(s => !s.required) || state.services[0] || { id: 'service_id' };
                const blockSnippet = `<!-- Loads only after consent for '${firstService.id}' -->
<script type="text/plain" data-service="${firstService.id}" src="https://example.com/tracker.js">${scriptClose}

<script type="text/plain" data-service="${firstService.id}">
  console.log('This code only runs when the service is allowed.');
${scriptClose}`;
                blockingEl.textContent = blockSnippet;
            }

            function hydrateFields() {
                document.querySelectorAll('[data-field]').forEach(input => {
                    const val = getByPath(state, input.dataset.field);
                    if (input.type === 'checkbox') {
                        input.checked = !!val;
                    } else {
                        input.value = val || '';
                    }
                    const eventName = input.tagName === 'SELECT' || input.type === 'color' || input.type === 'checkbox' ? 'change' : 'input';
                    input.addEventListener(eventName, handleFieldChange);
                });
            }

            function bindTemplates() {
                document.querySelectorAll('[data-template]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tpl = templates[btn.dataset.template];
                        if (tpl) {
                            state.services.push({ ...tpl });
                            renderServices();
                            renderScript();
                        }
                    });
                });
            }

            function bindCopyButtons() {
                document.querySelectorAll('[data-copy-target]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const targetId = btn.dataset.copyTarget;
                        const target = document.getElementById(targetId);
                        if (!target) return;
                        const value = target.value || target.textContent;
                        navigator.clipboard.writeText(value).then(() => {
                            statusEl.textContent = 'Copied ‚úîÔ∏è';
                        }).catch(() => {
                            statusEl.textContent = 'Could not copy üòï';
                        });
                    });
                });
            }

            function bindAddService() {
                const addBtn = document.getElementById('add-service');
                addBtn.addEventListener('click', () => {
                    state.services.push(createServiceTemplate());
                    renderServices();
                    renderScript();
                });
            }

            function bindScrollLink() {
                const scrollBtn = document.getElementById('scrollToOutput');
                if (!scrollBtn) return;
                scrollBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById('output').scrollIntoView({ behavior: 'smooth' });
                });
            }

            hydrateFields();
            renderButtons();
            renderServices();
            renderScript();
            bindTemplates();
            bindCopyButtons();
            bindAddService();
            bindScrollLink();
        })();
    </script>

    <script defer src="https://analytics.speetzen.eu/script.js" data-website-id="fc91efdd-c846-4817-b573-fe97387d9385" type="text/plain" data-service="umami"></script>
    
</body>

</html>
